# VAC 使用说明

## 安装

```bash
# 从源码构建
cargo build --release

# 运行
./target/release/vac
```

## 快捷键

### 扫描操作

| 按键 | 功能 |
|------|------|
| `s` | 扫描预设可清理目录 |
| `S` | 扫描用户主目录 |
| `d` | 输入自定义路径扫描 |

### 浏览与排序

| 按键 | 功能 |
|------|------|
| `↑` / `k` | 向上移动 |
| `↓` / `j` | 向下移动 |
| `g` | 跳到列表顶部 |
| `G` | 跳到列表底部 |
| `Ctrl+d` / `PageDown` | 向下翻半页 |
| `Ctrl+u` / `PageUp` | 向上翻半页 |
| `Enter` | 进入目录 |
| `Backspace` / `Esc` | 返回上一级（扫描中为取消） |
| `o` | 切换排序方式（名称/大小） |
| `/` | 搜索/过滤列表 |

### 选择与清理

| 按键 | 功能 |
|------|------|
| `Space` | 选择/取消选择当前项 |
| `a` | 全选/取消全选（当前视图） |
| `c` | 执行清理（进入确认模式） |

### 其他

| 按键 | 功能 |
|------|------|
| `?` | 显示/隐藏帮助 |
| `q` | 退出程序 |

## 扫描模式

### 预设可清理目录扫描 (`s`)

VAC 会扫描以下 macOS 常见可清理目录：

1. **系统缓存** - `~/Library/Caches`
2. **日志文件** - `~/Library/Logs`
3. **临时文件** - `/tmp` 和 `/var/tmp`
4. **Xcode 派生数据** - `~/Library/Developer/Xcode/DerivedData`
5. **Homebrew 缓存** - `~/Library/Caches/Homebrew`
6. **CocoaPods 缓存** - `~/Library/Caches/CocoaPods`
7. **npm 缓存** - `~/.npm/_cacache`
8. **pip 缓存** - `~/Library/Caches/pip`
9. **Docker 数据** - `~/Library/Containers/com.docker.docker/Data`
10. **Cargo 缓存** - `~/.cargo/registry/cache`
11. **下载文件夹** - `~/Downloads`
12. **垃圾桶** - `~/.Trash`

以上目录仅在存在时才会被扫描。

### 主目录扫描 (`S`)

扫描用户主目录下的所有顶层文件和目录，按大小排序显示。

### 自定义路径扫描 (`d`)

按 `d` 键进入路径输入模式，可以输入任意目录路径进行扫描。支持使用 `~` 表示用户主目录。

## 搜索/过滤

按 `/` 键进入搜索模式，输入关键词实时过滤当前列表。匹配规则为大小写不敏感的名称包含匹配。

- `Enter` 确认搜索结果（保留过滤后的列表）
- `Esc` 取消搜索（恢复原始列表）

## 排序功能

在目录浏览时，按 `o` 键可在以下两种排序方式之间切换：

- **按名称排序**：目录优先，同类型按字母顺序排序
- **按大小排序**：按文件/目录大小降序排序

当前排序方式会显示在底部状态栏中。

## 层级浏览

- 根目录扫描完成后，可通过 `Enter` 进入目录逐级浏览
- 列表包含目录和文件，目录会以 `/` 结尾
- 目录大小可能需要一点时间回填，显示为 `…` 表示正在计算
- 当条目超出屏幕时，右侧会显示滚动条

## 确认删除

按 `c` 进入确认模式后，弹窗会列出所有待删项目（按大小降序），可用 `j`/`k` 滚动查看。按 `Enter` 确认删除，按 `Esc` 取消。

清理完成后，底部状态栏会短暂显示释放的空间大小和条目数。

## 安全机制

- 使用 `canonicalize` 解析符号链接，防止通过符号链接绕过安全检查
- 禁止删除系统关键目录（`/`, `/System`, `/Library` 等）
- 禁止删除用户根目录本身
- 仅允许删除用户目录下的子目录/文件和临时目录下的内容
- 目录遍历不跟随符号链接（`follow_links(false)`）
- 删除前需要二次确认，可预览待删项
- 清理目录内容时保留目录本身

## 注意事项

- 清理操作**不可逆**，请在清理前仔细确认
- 建议先备份重要数据
- 部分缓存删除后可能影响应用启动速度（会自动重建）
- Xcode DerivedData 删除后需要重新构建项目
- Docker 数据清理可能导致容器和镜像丢失